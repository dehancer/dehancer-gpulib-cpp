set (EMBEDDED_WATERMARK_C_TARGET EmbeddedWatermarks${PROJECT_LIB_PLATFORM_SUFFIX})

file (GLOB EMBEDDED_WATERMARKS ${EMBEDDED_WATERMARKS}
        ${CMAKE_SOURCE_DIR}/src/rc/watermarks/*.png
        )

set (EMBEDDED_WATERMARK_C_FILES "")

add_custom_target(${EMBEDDED_WATERMARK_C_TARGET} ALL DEPENDS ${EMBEDDED_WATERMARK_C_FILES} WORKING_DIRECTORY  ${EMBEDDED_IMAGES_DIR} )

add_custom_command(
        TARGET ${EMBEDDED_WATERMARK_C_TARGET} PRE_BUILD
        COMMAND ${CMAKE_COMMAND} -E make_directory ${EMBEDDED_IMAGES_DIR}
        DEPENDS ${EMBEDDED_IMAGES_DIR}
        COMMENT "Created output directory"
)

foreach(image ${EMBEDDED_WATERMARKS})

    get_filename_component(fname ${image} NAME_WE)
    get_filename_component(name ${image} NAME)
    get_filename_component(ext ${image} EXT)
    get_filename_component(abs_path ${CMAKE_CURRENT_SOURCE_DIR}/${src} PATH)
    get_filename_component(rel_path ${image} PATH)

    set(src_file dehancer_${fname})
    set(embedded_file dehancer_${fname}.c)

    message("IMAGE:  ${embedded_file}   ${fname} ${abs_path} ${rel_path}")

    set(embedded_files "")

    add_custom_command(
            TARGET ${EMBEDDED_WATERMARK_C_TARGET} PRE_BUILD
            COMMAND ${CMAKE_COMMAND} -E copy ${image} ${EMBEDDED_IMAGES_DIR}/${src_file}
            DEPENDS ${image}
            COMMENT "Copy ${image} -> ${EMBEDDED_IMAGES_DIR}/${src_file}"
    )

    add_custom_command(
            TARGET ${EMBEDDED_WATERMARK_C_TARGET} PRE_BUILD
            WORKING_DIRECTORY  ${EMBEDDED_IMAGES_DIR}
            COMMAND xxd
            -i ${src_file}
            ${embedded_file}
            DEPENDS ${image}
            COMMENT "compile watermarks opencl code from ${name} -> ${embedded_file}"
    )

    set(EMBEDDED_WATERMARK_C_FILES "${EMBEDDED_IMAGES_DIR}/${embedded_file};${EMBEDDED_WATERMARK_C_FILES}")

endforeach()

message("EMBEDDED_WATERMARK_C_FILES ${EMBEDDED_WATERMARK_C_FILES}")

set_source_files_properties(${EMBEDDED_WATERMARK_C_FILES} PROPERTIES GENERATED TRUE)
set (TEST_LIBRARIES)
set (CMAKE_CXX_STANDARD 17)

if (GTEST_FOUND)
    include_directories(${GTEST_INCLUDE_DIRS})
    set(TEST_LIBRARIES ${GTEST_BOTH_LIBRARIES})
else()
    set(TEST_LIBRARIES gtest;gtest_main)
endif()

file(GLOB TESTS_SOURCES ${TESTS_SOURCES}
        ./*.cpp
        ./*.mm
        )

include_directories(
        ./
        ${CMAKE_BINARY_DIR}/external/include
)

if (DEHANCER_CURRENT_PLATFORM_METAL)
    set (PROJECT_LIB_PLATFORM ${PROJECT_LIB}_metal)
    add_executable(${TEST} ${TESTS_SOURCES})
elseif(DEHANCER_CURRENT_PLATFORM_OPENCL)
    set (PROJECT_LIB_PLATFORM ${PROJECT_LIB}_opencl)
    add_executable(${TEST} ${TESTS_SOURCES} ${EMBEDDED_OPENCL_KERNELS})
endif ()

target_link_libraries(
        ${TEST}
        ${PROJECT_LIB_PLATFORM}
        clHelperLib
        ${COMMON_LIBRARIES}
        ${TEST_LIBRARIES}
        ${CMAKE_DL_LIBS}
)

if (COMMON_DEPENDECIES)
    add_dependencies(
            ${TEST}
            ${COMMON_DEPENDECIES}
    )
endif ()

if(DEHANCER_GPU_METAL)
    add_dependencies(
            ${TEST}
            TestKernels
    )
endif()

add_test(test ${TEST})
enable_testing()

